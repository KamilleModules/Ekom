Selling anything with ekom
==========================
2017-08-29



A product in ekom is very well defined and modelized with the ek_product table and friends (attributes tables).

However in reality, what we sell does not necessarily fit this very broad model.

For instance, how do you handle products which depend on time?


Hence the question appears: how do we sell anything with ekom?

My answer is this:

if you want to, you can always create your own system, side to side with ekom,
but then you can't benefit out-of-the-box features from ekom anymore.

So, rather I would say:

- first modelize your product as you wish, independently from ekom
- then, interface your product with ekom


For the first part, you know what to do, it depends on your product.
So, create all the tables necessary to support your product logic.

For the second part, ekom has different things you can hook in, but mostly the following ones:

- the product box model, generated by the ProductLayer, is used by many gui templates:
        - the cart
        - the mini-cart
        - the user account's last products history
        - the user account's orders
        - the checkout process
        - the product page
    In fact, to be honest, the approach in ekom is to use the product box model every time a product 
    needs to be displayed.
    
    Therefore, it might be judicious to hook into that model.        
    I will discuss this in more depth later.
            
- then you have the cart in session:
     the user needs to put your product in the session cart, as the session cart is a fundamental
     element that makes the purchase possible. 




So, what about hooking the product box model?
=========================

The product box model is used all over the place in ekom.
It's generated by the ProductLayer.

So, if you hook the ProductLayer object correctly, you'll be able to control the product box model. 

Even if you don't use all of the following features, this is what you get out-of-the-box for
hooking the ProductLayer:

- tax system   
- discounts (flexible, because php language can be used)  
- multilingual description and labels
- an image system
- attributes (although if you read this, it's probably because attributes are not enough anymore...)
- maybe other things...





The product Details idea
-----------------------------

So, let's suppose you are familiar with the ProductLayer, and you know which method generates the product box model.
If that's the case, you also know that this method is using the first layer of cache in ekom called Tabatha.

So let's give the example of a product using product details
(that's a general pattern one can re-use as an idea or a model for one's own custom products).


The main idea is that you sell a product (which you can modelize in the ek_product table), but the details
are organized elsewhere (in other tables that you create).

And, the details are required to uniquely characterize your product.
This means the default product ref (ek_product.ref) is not unique anymore, but rather needs to be completed
with the product details to be unique.

This happens with products which characteristics change with time.
For instance, if you sell an event, you can think of it as the product you are selling, 
and you can think of the date as a detail of the product you are selling.

Or if you want, you can even think of the ticket as the thing you are selling, and the event name and the date
as the details... 


So, but the details might influence the price for instance, and/or the quantity, and hence we need to hook
into the ProductLayer.

We generally would use the $_GET array to pass the product details, so that we could display
different product configurations just by playing with the url (since the ref is not unique, that's all we have left).

Our first problem is the ProductLayer's tabatha caching.
We want to benefit this caching, and so we need to provide a unique cache identifier.

The ProductLayer method provides a system for you to enhance the product's default cache identifier,
via the ApplicationRegistry, I will let you read the source code for yourself.

Once you've passed the cache problem, you are inside the code, and now you can use the different hooks
of the ProductLayer method as you wish.






  















